<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.basakcoding.basak.mapper.CourseMapper">
	<!-- 카테고리 리스트 가져오기 -->
	<select id="categoryList" resultType="CategoryDTO">
		SELECT * FROM category
	</select>

	<!-- 강의 리스트 가져오기 -->
	<select id="selectList" resultType="Map">
		SELECT ca.name CAT_NAME, co.course_id, co.title, co.short_description, a.name ADM_NAME FROM courses co
		JOIN category ca ON ca.category_id = co.category_id
		JOIN admins a ON co.admin_id = a.admin_id
	</select>
	
	<!-- 강의 생성 후 강의 PK반환 -->
	<insert id="createCourse" parameterType="Map">
		<selectKey keyProperty="courseId" resultType="int" order="BEFORE">
			SELECT seq_courses.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO courses VALUES(#{courseId}, #{adminId}, #{categoryId}, #{courseTitle}, #{shortDescription}, 
		#{description}, #{price}, #{difficulty}, DEFAULT, #{thumbnail}, DEFAULT, DEFAULT, DEFAULT, DEFAULT)
	</insert>
	
	<!-- FAQ 생성 -->
	<insert id="createFaq" parameterType="Map">
		INSERT INTO faq VALUES(seq_faq.NEXTVAL, #{courseId}, #{title}, #{content})
	</insert>
	
	<!-- 커리큘럼 생성 -->
	<insert id="createCurri" parameterType="Map">
		<selectKey keyProperty="curriculumId" resultType="int" order="BEFORE">
			SELECT seq_curriculum.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO curriculum VALUES(#{curriculumId}, #{courseId}, #{name})
	</insert>
	
	<!-- 비디오 생성 -->
	<insert id="createVideo" parameterType="Map">
		<selectKey keyProperty="videoId" resultType="int" order="BEFORE">
			SELECT seq_video.NEXTVAL FROM dual
		</selectKey>
		INSERT INTO video VALUES(#{videoId}, #{curriculumId}, #{videoUri}, DEFAULT, null, #{videoTitle})
	</insert>
	
	<!-- 파일 생성 -->
	<insert id="createFile" parameterType="Map">
		INSERT INTO files VALUES(seq_files.NEXTVAL, #{videoId}, #{fileName}, #{fileUri})
	</insert>
</mapper>